---
toc: false
date: 1652872376408
title: '关于DNS'
link: '/post/browser/about_DNS'
file: 'about_DNS'
scope: ['browser']
buckets: ['post', 'browser']
draft: false
visible: true
lang: 'zh'
layout: 'page'
---

![about_dns_cover](https://res.zrain.fun/images/2022/06/about_dns_cover-6f8b7b362329a58fb794adacff781fe7.png)

## 什么是 DNS

在了解 DNS 之前，需要了解一个概念：域名（Domain），它是一个在互联网上标识主机或主机组的名称，相当于 IP 地址的别名，相对于晦涩难记的 IP 地址，域名更显得易于记忆。而 IP 于域名之间的转换就需要借助 DNS（Domain Name System）域名系统了。它是将域名解析 IP 地址的一项互联网基础服务，提供该服务的服务器称为 域名服务器（Domain Name Server）。

## DNS 解析过程

互联网上的域名系统是一个分布式的系统，结构上是一个四层的树状层次结构，如下图所示：

<CenterImg src="https://res.zrain.fun/images/2022/05/dns-89e7cb38c62436dd67f66a2bde5c5f79.png" alt="DNS" zoom="40%" />

<br/>

可以看到：这个世界上没有一台 DNS 服务器拥有因特网上所有主机的映射，每台 DNS 只负责部分映射。接着来看看每个类型的服务器。

### 本地域名服务器

本地 DNS 服务器并不属于 DNS 的层次结构，但它对 DNS 层次结构是至关重要的。每个 ISP 都有一台本地 DNS 服务器，比如一个居民区的 ISP、一个大学的 ISP、一个机构的 ISP，都有一台或多台本地 DNS 服务器。当主机发出 DNS 请求时，该请求被发往本地 DNS 服务器，**本地 DNS 服务器起着代理的作用**，并负责将该请求**转发**到 DNS 服务器层次结构中。

### 根域名服务器

当本地域名服务器查询不到解析结果时，第一步会向它进行查询，并获取顶级域名服务器的 IP 地址。全球一共有 13 个根域名服务器（除了它们的镜像），它们并不直接用于域名解析，仅用于指出可查询的顶级域名服务器。

这里有个需要注意的点：根域名是什么？比如 `www.baidu.com`，可能会误以为 `com` 就是根域名，但其实 `com` 是顶级域名，网址完整写法是 `www.baidu.com.`，最后的这个 “<Icon icon="carbon:dot-mark" />” 就是根域名。

### 顶级域域名服务器

除了前面提到的`com`是顶级域名，常见的顶级域名还有`cn`、`org`、`edu`等。顶级域 DNS 服务器，也就是 TLD，提供了它的下一级，也就是权威 DNS 服务器的 IP 地址。

### 权威域名服务器

权威 DNS 服务器可以返回主机-IP 的最终映射。

## 解析方式

DNS 解析分为 **递归查询** 和 **迭代查询**（在算法中也被称为递推）两种方式。客户端与本地域名服务器之间一般采用递归查询，而 DNS 服务器之间一般采用迭代查询。

- **递归查询**

如果 DNS 服务器查不到该域名，那么它将重新以客户端的身份向其他 DNS 服务器发送查询请求报文，客户端只要等待最终结果即可。

- **迭代查询**

如果 DNS 服务器查不到该域名，它不会替客户端完成后续的查询工作，而是回复下一步应当向哪一个域名服务器进行查询，随后客户端重新向这个新的 DNS 服务器发送查询请求。

<CenterImg src="https://res.zrain.fun/images/2022/05/dns_2-4b4a91ec457738ebf1feb22cf7ee8432.png" alt="DNS_process_2" zoom="50%" />

<br/>

下面是个 DNS 解析示例。假设主机`m.n.com`想要获取主机`a.b.com`的 IP 地址，会经过以下几个步骤：

1. 首先，主机`m.n.com`向它的本地 DNS 服务器发送一个 DNS 查询报文，其中包含期待被转换的主机名`a.b.com`。

2. 本地 DNS 服务器将该报文转发到根 DNS 服务器。

3. 该根 DNS 服务器注意到`com`前缀，便向本地 DNS 服务器返回`com`对应的顶级域 DNS 服务器（TLD）的 IP 地址列表。意思就是：我不知道`a.b.com`的 IP，不过这些 TLD 服务器可能知道，你去问他们吧。

4. 本地 DNS 服务器则向其中一台 TLD 服务器发送查询报文。

5. 该 TLD 服务器注意到`b.com`前缀，便向本地 DNS 服务器返回权威 DNS 服务器的 IP 地址。意思就是，我不知道`a.b.com`的 IP，不过这些权威服务器可能知道，你去问他们吧。

6. 本地 DNS 服务器又向其中一台权威服务器发送查询报文。

7. 终于，该权威服务器返回了`a.b.com`的 IP 地址。

8. 本地 DNS 服务器将`a.b.com`跟 IP 地址的映射返回给主机`m.n.com`，`m.n.com`就可以用该 IP 向`a.b.com`发送请求啦。

### DNS 缓存

为了让我们更快的拿到想要的 IP，DNS 广泛使用了缓存技术。DNS 缓存的原理非常简单，在一个 DNS 查询的过程中，当某一台 DNS 服务器接收到一个 DNS 应答（例如，包含某主机名到 IP 地址的映射）时，它就能够将映射缓存到本地，下次查询就可以直接用缓存里的内容。当然，缓存并不是永久的，每一条映射记录都有一个对应的生存时间，一旦过了生存时间，这条记录就应该从缓存移出。

事实上，**有了缓存，大多数 DNS 查询都绕过了根 DNS 服务器**，需要向根 DNS 服务器发起查询的请求很少。
